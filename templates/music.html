<script>
    var ap = new APlayer({
        element: document.getElementById('aplayer'),
        showlrc: false,
        fixed: true,
        mini: true,
        audio: [
            {
                title: '向云端',
                author: '小霞/海洋Bo',
                url: 'https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VXOGRLM0xkM2RwQnBHUDdDR2l5Si1jQkF3d0xoZGZlSHE5Qk9VeHJnVVN3N3c_ZT12d05zMXo.mp3',
                pic: 'https://p2.music.126.net/TmOHxaGnFNlwNX8aPz66oA==/109951168638913915.jpg?param=130y130'
            },
            {
                title: "南山南",
                author: '张磊',
                url: 'https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VhMGlpeE5zR3NkSGdQYXhqZ0JsZ1BFQnYwZW9KaUlOTHNTcHRBZjhrMWtxSVE_ZT1kb08wUFQ.mp3',
                pic: 'https://p1.music.126.net/sF17Bq1KRm9vdBMjvhXTvQ==/109951165134399856.jpg?param=130y130'
            },
            {
                title: "童言无忌",
                author: "王以太",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VVekxCbHExYV94QnZwTlE3eTdSWThNQk5XN09aRHNVYlZDNlQybnYzdzRHc0E_ZT1nemdhNlk.mp3",
                pic: "https://p1.music.126.net/Z80wn4m5lgLcQqe09CKnvQ==/109951162830156702.jpg?param=130y130"
            },
            {
                title: "稻香",
                author: "周杰伦",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VhYlQzeGdOeXpwTnZpMFBWZ21sQ3VjQnBZR0VEWnplNUppZ0s5VWZUOXlpZFE_ZT02THhPQzM.mp3",
                pic: "https://p2.music.126.net/DpAuXTXlirLKXawYxJo70g==/109951164579389026.jpg?param=130y130"
            },
            {
                title: "晴天",
                author: "周杰伦",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VZR0FXSU45X2JKTWdlRGdjMnhNbHRvQk40VmNjc0xfSnljS1cwbXJWbHJDRWc_ZT1iM0NSVDE.mp3",
                pic: "https://p1.music.126.net/DpAuXTXlirLKXawYxJo70g==/109951164579389026.jpg?param=130y130"
            },
            {
                title: "向阳而生(日出)",
                author: "华晨宇",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VRVjctd19ZT2Q1T21Gd2VYSHdxU1dnQkplOVNTc0tfTTNucnV2c0Y3bFFETUE_ZT1hZ0QxVWs.mp3",
                pic: "https://p1.music.126.net/w1A7-Eqx26C0-ANXd3NolA==/109951169646542385.jpg?param=130y130"
            },
            {
                title: "若把你",
                author: "刘瑾睿",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VlZXlvbkpZNllkR3VMNDZDMk00VjFZQkRZYVRkTU5kYkxBanBrZHFSSFlLTlE_ZT11bnVaN2o.mp3",
                pic: "https://p2.music.126.net/M877M2-VhWZiLPVFORf9iQ==/109951163401482434.jpg?param=130y130"
            },
            {
                title: "程艾影",
                author: "赵雷",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VadFZuNTZyRXdOTm10ODQ3aTk2cG9BQkdFVExWdDgxbFZHMWtTd0t4WURlTFE_ZT1nUXFoWVk.mp3",
                pic: "https://p2.music.126.net/ykR7CGYNj_a6wcn_8u0t5g==/109951169213377336.jpg?param=130y130"
            },
            {
                title: "我记得",
                author: "赵雷",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VYcDVETEtSS3VwUHR3U0tNSGJUNUJRQjZkMkpKaGE1TmdwMVk3b2Y5aW9KUFE_ZT1iaVg0RWk.mp3",
                pic: "https://p2.music.126.net/ykR7CGYNj_a6wcn_8u0t5g==/109951169213377336.jpg?param=130y130"
            },
            {
                title: "南方姑娘",
                author: "赵雷",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VackdYZ2Fla1lwQXJVb2pCV1pEcVZZQlpScHRXRGxtWlZ5S0RpNXZLSWsxZkE_ZT1mbTdRZms.mp3",
                pic: "https://p2.music.126.net/btBocL7KKvl0sRZY62_BIA==/109951169213244790.jpg?param=130y130"
            },
            {
                title: "三十岁的女人",
                author: "赵雷",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VYekhrcDFNWUlKTXI5U1k0VFlWRjdnQlQ0R2JpbGVFOFR5c3VCMkZnTWlGRlE_ZT1uZURPVGw.mp3",
                pic: "https://p2.music.126.net/pwcUlwh9MFZ_V3hGBOPaCQ==/109951169213425474.jpg?param=130y130"
            },
            {
                title: "莉莉安",
                author: "宋冬野",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VhVHFweUNVVjc1T3RSb211c2JLWTRrQkNVS0NIZ19wTDR3eFBKdzY3Tkh5cmc_ZT1DY2xrcnc.mp3",
                pic: "https://p1.music.126.net/GcRunGm02vZBicYmIN6GXw==/109951163200249252.jpg?param=130y130"
            },
            {
                title: "风驶过的声音",
                author: "海洋Bo/费米",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VVd1pOeVhhNmFGSHBiamZ5MGxCazVnQnZVMlRLaG92SzFsNGRfOW1SY2dPS2c_ZT1UNGc3UWw.mp3",
                pic: "https://p2.music.126.net/gfLR-3TEncp1cOog8oUaFA==/109951168567036973.jpg?param=130y130"
            },
            {
                title: "妈妈的二十岁",
                author: "海洋Bo",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VUemt2MElfOXlGQ2hiUWh4Ni1WcjdZQm83UnVPSEIwelBIWmhvUUFHd0NLT1E_ZT04RWxBR3Q.mp3",
                pic: "https://p2.music.126.net/L-mkHJOhOXSMAZpkPAGDWw==/109951168600536093.jpg?param=130y130"
            },
            {
                title: "普通人生",
                author: "海洋Bo",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VTN0p4STZxX1hCT29FVUpJLUpvM2NrQl9SNkZPdWFXczZJVTktblhPajBtSGc_ZT1HNlF5WWs.mp3",
                pic: "https://p2.music.126.net/Z7SFxeQ5LH4YQP_7gOjWbw==/109951168565288639.jpg?param=130y130"
            },
            {
                title: "我的美丽",
                author: "海洋Bo/高睿",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VWVnR5ZlVmWmJWRXNVMVdBNFRVWWJrQlZ1TWVqRmhPZnEwOUJJVTZCVk9yNlE_ZT1RZ0hvYmg.mp3",
                pic: "https://p1.music.126.net/8ZpCzo4gEeCAQyXAGYXKUQ==/109951167854450663.jpg?param=130y130"
            },
            {
                title: "小宇",
                author: "刘大拿",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VjXzNxNDZyM3FsTm5rUHdzMHVJa3djQk9hdWlQYThISEZJOGtleGZCNHVGM1E_ZT1Wb3hoYUc.mp3",
                pic: "https://p2.music.126.net/YriQ6aCjI77aejAqRY47xQ==/109951167554427997.jpg?param=130y130"
            },
            {
                title: "夏天的风",
                author: "火羊瞌睡了",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VjODkwMXQySkJOQWhqNkNhRzBFTlhvQnFLSnlOX25mdGJzSHdfdS1oZGxNNXc_ZT14aGplQUk.mp3",
                pic: "https://p1.music.126.net/rFUKVdOjqxgwAT6Zi6qv7A==/109951164906689206.jpg?param=130y130"
            },
            {
                title: "经济舱",
                author: "KeyL刘聪",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VZeDZ2SVplYS0xTnBQV1liMGhId0dNQk02MXNlMFZNS3kxeHEzY2FYZTM1Wmc_ZT1NNEVMT0I.mp3",
                pic: "https://p2.music.126.net/fEOnFVVXSAe2LThsNfx0XA==/109951165432413857.jpg?param=130y130"
            },
            {
                title: "迷途羔羊",
                author: "兄弟本色/张震岳",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VRaFc3UnVob3NKSXB0RDJtUm8xSXg4QkdhbERVZU9qY1lBOWxOZldFN3Z3Nnc_ZT1iamZkQ3Q.mp3",
                pic: "https://p2.music.126.net/b1eSBbx2Yia0k89ocfOnjQ==/18677404023325159.jpg?param=130y130"
            },
            {
                title: "无处安放",
                author: "汪峰",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VXd1EyNlZ1NW5WQm5ZUHJ1MmlfNWNBQnB4YkRoWHRmOTVLa0RJT0JReWlDZWc_ZT1BV3dNbWo.mp3",
                pic: "https://p1.music.126.net/TuMxC8-vj1PjVuykXabIgg==/109951169639046141.jpg?param=130y130"
            },
            {
                title: "日落大道",
                author: "梁博",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VhYVlTSjRBbm9CQmtHZ0t5Tl9tNDNVQmd6OWhXMUpVdkxJMFdrQkRHOVQxTGc_ZT1Nd3FaYUs.mp3",
                pic: "https://p1.music.126.net/bkBg46eD1bS9D2mzxnKAnQ==/3395291910036707.jpg?param=130y130"
            },
            {
                title: "Easy on me",
                author: "Adele",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0Vkdjl5cFJDWC1OSHJucGpsZklGMkNBQm9LVU0xeHBkTXhybURDZmxRMWxPcXc_ZT0zS3dVRWw.mp3",
                pic: "https://p2.music.126.net/t0G-13az8_lEnrDRRntLWA==/109951166639576807.jpg?param=130y130"
            },
            {
                title: "Someone like you",
                author: "Adele",
                url: "https://dlink.host/sharepoint/aHR0cHM6Ly9waWNvZmFyZWFzdC1teS5zaGFyZXBvaW50LmNvbS86dTovZy9wZXJzb25hbC9qYW1lc19jaGFuX3BpY29fY29tL0VXWGVyWTkySFpCS21MQk94a3RZUzFvQnctZjFNYlN4TVMyY3dOazBLNEs0d1E_ZT1kQUNKZFg.mp3",
                pic: "https://p2.music.126.net/t0G-13az8_lEnrDRRntLWA==/109951166639576807.jpg?param=130y130"
            },
        ]
    });


    function doStuff() {
    var flag = 0; // 用于标记是否成功获取到了aplayer对象

    try {
        ap = ap; //获取aplayer实例对象
        ap.list; //获取aplayer对象的list属性，用于控制播放列表
        flag = 1; // 如果没有抛出异常，则设置flag为1表示成功获取到了aplayer对象
        console.log('成功获取aplayer实例对象', ap.list)
    } catch (error) {
        setTimeout(doStuff, 50); // 如果获取aplayer对象失败，则等待50毫秒后再尝试
        console.error("不获取aplayer实例对象，并捕获到错误：", error);
        return;
    }

    if (flag) { // 如果成功获取到了aplayer对象
        document.getElementsByClassName("aplayer-icon-menu")[0].click() // 模拟点击播放器右上角的菜单按钮

        // 检查是否有保存的音乐索引
        if (localStorage.getItem("musicIndex") != null) {
            musicIndex = localStorage.getItem("musicIndex"); // 从localStorage中获取音乐索引，即目前在播放哪一首歌！
            ap.list.switch(musicIndex); // 切换到指定的音乐索引
        }

        // 检查是否有保存的音乐时间
        if (sessionStorage.getItem("musicTime") != null) {
            window.musict = sessionStorage.getItem("musicTime"); // 从sessionStorage中获取音乐时间
            ap.setMode(sessionStorage.getItem("musicMode")); // 设置播放模式
            if (sessionStorage.getItem("musicPaused") != '1') { // 检查是否是暂停状态，1是播放，0是暂停
                ap.play();
            }

            var g = true; //加个变量以防鬼畜但是不知道怎么节流qwq；// 添加一个变量g，用于控制是否可以进行seek操作
            ap.on("canplay", function() { // 当音乐可以播放时
                if (g) {
                    ap.seek(window.musict); // 跳转到指定的音乐时间
                    g = false; //如果不加oncanplay的话会seek失败就这原因炸很久；// 修改g的值，避免多次调用seek方法
                }
            });
        } else {
            sessionStorage.setItem("musicPaused", 1); // 如果没有保存音乐时间，则将音乐设为暂停状态
            ap.setMode("mini"); // 将播放器设置为迷你模式
        }

        // 检查是否有保存的音量设置
        if (sessionStorage.getItem("musicVolume") != null) {
            ap.audio.volume = Number(sessionStorage.getItem("musicVolume")); // 设置音量
        }

        // 当音乐暂停时
        ap.on("pause", function() {
            sessionStorage.setItem("musicPaused", 1); // 更新sessionStorage中的音乐为暂停状态
        }); //原基础上加了个检测暂停免得切换页面后爆零(bushi)（指社死）

        // 当音乐播放时
        ap.on("play", function() {
            sessionStorage.setItem("musicPaused", 0); // 更新sessionStorage中的音乐为播放状态
        });

        // 当音量发生变化时
        ap.audio.onvolumechange = function() {
            sessionStorage.setItem("musicVolume", ap.audio.volume); // 更新sessionStorage中的音量设置
        }; //新版增加保存音量免得切换页面爆零


        // 使用setInterval函数定期执行以下代码，即每隔200ms就更新一次播放状态和进度
        setInterval(function() {
            musicIndex = ap.list.index; // 获取当前播放的音乐索引(歌曲的索引，index=0 为第一首歌)
            musicTime = ap.audio.currentTime; // 获取当前音乐的播放时间
            musicMode = ap.mode; //获取当前音乐的播放模式
            localStorage.setItem("musicIndex", musicIndex); // 保存当前播放的音乐索引到localStorage
            sessionStorage.setItem("musicTime", musicTime); // 保存当前音乐的播放时间(进度)到sessionStorage
            sessionStorage.setItem("musicMode", musicMode); // 保存当前的播放模式到sessionStorage
        }, 200); // 每200毫秒更新一次播放状态和进度；节流，200ms精度感知不大
    };
};


document.addEventListener('DOMContentLoaded', function() {
    // 这里的代码将在文档解析完成后执行
    doStuff();
});




</script>

